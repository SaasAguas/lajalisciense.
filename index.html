<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PaleterÃ­as Ferguz</title>

    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="logo_ferguz.png">
    <link rel="shortcut icon" type="image/png" href="logo_ferguz.png">
    <link rel="apple-touch-icon" href="logo_ferguz.png">
    <meta name="theme-color" content="#F50057">

    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="login-overlay">
        <div class="login-box" id="view-login">
            <img src="logo_ferguz.png" alt="Logo Ferguz" style="width: 120px; margin-bottom: 10px;" class="logo-anim">
            <h2 style="color:var(--primary); margin:0 0 10px 0;">Bienvenido</h2>
            <p style="color:#666; margin-top:0;">PaleterÃ­as Ferguz</p>
            
            <input type="text" id="login-user" class="login-input" placeholder="Usuario">
            <input type="password" id="login-pass" class="login-input" placeholder="ContraseÃ±a">
            
            <button class="btn btn-primary" onclick="attemptLogin()">Entrar</button>
            <p id="login-error" style="color:red; display:none; margin-top:10px; font-size:0.9rem;">Datos incorrectos</p>
            
            <span class="link-text" onclick="toggleAuthView('register')">Â¿No tienes cuenta? RegÃ­strate aquÃ­</span>
        </div>

        <div class="login-box" id="view-register" style="display: none;">
            <h2 style="color:var(--primary); margin:0 0 10px 0;">Registro de Personal</h2>
            <p style="color:#666; margin-top:0; font-size:0.9rem;">Requiere cÃ³digo de creador</p>
            
            <input type="text" id="reg-user" class="login-input" placeholder="Nuevo Usuario">
            <input type="password" id="reg-pass" class="login-input" placeholder="ContraseÃ±a">
            
            <select id="reg-role" class="login-input">
                <option value="empleado">Emplead@</option>
                <option value="coo">COO</option>
                <option value="ceo">CEO</option>
            </select>

            <input type="password" id="reg-code" class="login-input" placeholder="CÃ³digo de AprobaciÃ³n" style="border-color:var(--warning);">
            
            <button class="btn btn-success" onclick="attemptRegister()">Crear Cuenta</button>
            <span class="link-text" onclick="toggleAuthView('login')">Volver al Inicio de SesiÃ³n</span>
        </div>
        <p style="color:rgba(255,255,255,0.7); margin-top:20px; font-size:0.8rem;">Ferguz App Corporativa v5.0</p>
    </div>

    <div style="background: var(--primary); color: white; padding: 10px 15px; position: sticky; top:0; z-index: 900; display:flex; justify-content:space-between; align-items:center; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
        <div style="display:flex; align-items:center; gap:10px;">
            <img src="logo_ferguz.png" style="width:30px; height:30px; border-radius:50%; background:white; padding:2px;">
            <div style="display:flex; flex-direction:column;">
                <span style="font-weight:bold; font-size:0.9rem;" id="user-display">Invitado</span>
                <span style="font-size:0.7rem; opacity:0.8;" id="role-display">Rol</span>
            </div>
        </div>
        <button class="logout-btn" onclick="openSettings()">âš™ï¸</button>
    </div>

    <div id="screen-pos" class="screen active-screen">
        <div class="card">
            <div class="filter-container">
                <button class="filter-btn active" onclick="setFilter('fruta', this)">Fruta ğŸ“</button>
                <button class="filter-btn" onclick="setFilter('crema', this)">Crema ğŸ¥›</button>
                <button class="filter-btn" onclick="setFilter('paleta', this)">Paletas ğŸ¨</button>
            </div>
            
            <div id="price-container" style="background:#f9f9f9; padding:10px; border-radius:10px; margin-bottom:15px;">
                <label style="font-size:0.9rem; color:#666; font-weight:bold;">Tipo de Cliente (Agua):</label>
                <select id="price-select" style="width:100%; padding:10px; margin-top:5px; border:2px solid var(--primary-light); border-radius:8px; font-weight:bold; color:var(--primary);">
                    <option value="20" data-tipo="Menudeo">Menudeo ($20 x L)</option>
                    <option value="16" data-tipo="Mayoreo">Mayoreo ($16 x L)</option>
                    <option value="15" data-tipo="Especial">Especial ($15 x L)</option>
                </select>
            </div>
            
            <div id="fixed-price-msg" style="display:none; background:var(--primary-light); color:white; padding:10px; border-radius:10px; margin-bottom:15px; text-align:center; font-weight:bold;">
                Precios Fijos segÃºn producto
            </div>

            <div class="grid" id="flavors-grid"></div>
        </div>
    </div>

    <div id="cart-bar" class="cart-bar" onclick="showCheckout()">
        <span id="cart-count" style="background:white; color:var(--primary); padding:2px 8px; border-radius:10px; font-weight:bold;">0</span>
        <strong id="cart-total" style="font-size:1.1rem;">$0</strong>
        <span style="font-weight:bold;">Ver Carrito ğŸ›’</span>
    </div>

    <div id="screen-prod" class="screen">
        <div class="card">
            <h2 style="margin-bottom: 15px;">ğŸ­ ProducciÃ³n</h2>
            <div class="filter-container">
                <button id="btn-prod-fruta" class="filter-btn active" onclick="setProdMode('fruta')">Fruta ğŸ“</button>
                <button id="btn-prod-crema" class="filter-btn" onclick="setProdMode('crema')">Crema ğŸ¥›</button>
                <button id="btn-prod-paleta" class="filter-btn" onclick="setProdMode('paleta')">Paletas ğŸ­</button>
            </div>

            <p style="font-size:0.9rem; color:#666; text-align:center;" id="prod-subtitle">Registrar producciÃ³n de Fruta</p>
            
            <label style="font-weight:bold; color:var(--primary);">Producto:</label>
            <select id="prod-flavor" style="width:100%; padding:12px; margin:10px 0; border:2px solid var(--primary-light); border-radius:10px; background:white;"></select>
            
            <label style="font-weight:bold; color:var(--primary);">Cantidad a registrar:</label>
            <div class="qty-selector">
                <button class="qty-btn" onclick="adjustProd(-5)">-5</button>
                <input type="number" id="prod-qty" value="20" style="border:none; background:transparent; text-align:center; font-size:1.5rem; width:60px; font-weight:bold; color:var(--text);">
                <button class="qty-btn" onclick="adjustProd(5)">+5</button>
            </div>

            <button class="btn btn-primary" onclick="saveProduction()">Guardar ProducciÃ³n</button>
        </div>
    </div>

    <div id="screen-admin" class="screen">
        <div class="card" style="text-align:center; background: linear-gradient(135deg, var(--ferguz-pink), var(--ferguz-blue)); color: white;">
            <h2 style="color:white; border-bottom-color: rgba(255,255,255,0.2);">Caja del Turno</h2>
            <h1 id="stat-cash" style="font-size:3rem; margin:10px 0; text-shadow: 2px 2px 4px rgba(0,0,0,0.2);">$0</h1>
            
            <div class="stats-grid">
                <div class="stat-item"><span>Ventas (Aguas)</span><span class="stat-val" id="stat-sold-l">0 L</span></div>
                <div class="stat-item"><span>Ventas (Paletas)</span><span class="stat-val" id="stat-sold-p">0 Pz</span></div>
                <div class="stat-item"><span>Fab. (Aguas)</span><span class="stat-val" id="stat-prod-l">0 L</span></div>
                <div class="stat-item"><span>Relleno (Palet)</span><span class="stat-val" id="stat-prod-p">0 Pz</span></div>
            </div>

            <button id="btn-corte" class="btn hidden-role" style="background:rgba(255,255,255,0.25); color:white; margin-top:15px; border: 1px solid rgba(255,255,255,0.5);" onclick="closeDay()">ğŸ”’ Cerrar Turno (Corte de Caja)</button>
        </div>

        <div class="card">
            <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:2px solid var(--bg); padding-bottom:10px; margin-bottom:10px;">
                <h2 style="margin:0; border:none; font-size:1.1rem;" id="inv-title">Inventario</h2>
                <button class="btn-sm" onclick="toggleInvView()">ğŸ”„ Cambiar</button>
            </div>
            <div style="max-height:400px; overflow-y:auto;" id="inv-container"></div>
        </div>
    </div>

    <div id="screen-historial" class="screen">
        <div class="card">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <h2 style="margin:0;">ğŸ“ Turno Actual</h2>
                <div style="display:flex; gap:5px;">
                    <button onclick="downloadExcel()" class="btn-sm" style="background:var(--ferguz-green); color:#004d25; margin:0;">â¬‡ Excel</button>
                    <button id="btn-clear-hist" onclick="clearHistory()" class="btn-sm hidden-role" style="background:var(--danger); color:white; margin:0;">ğŸ—‘ Borrar</button>
                </div>
            </div>
            <div style="max-height:250px; overflow-y:auto; margin-bottom: 20px;" id="hist-current-container"></div>

            <h2 style="margin-top:20px; border-top: 2px solid var(--bg); padding-top:15px;">ğŸ“ Cortes HistÃ³ricos</h2>
            <div id="hist-cuts-container" style="max-height:300px; overflow-y:auto; padding-right:5px;"></div>
        </div>
    </div>

    <div id="checkout-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:2000; align-items:center; justify-content:center;">
        <div style="background:white; width:90%; max-width:400px; padding:25px; border-radius:15px; box-shadow:0 10px 25px rgba(0,0,0,0.2); border-top: 5px solid var(--primary);">
            <h3 style="margin-top:0; color:var(--primary);">ğŸ›’ Confirmar Venta</h3>
            <div id="checkout-list" style="max-height: 250px; overflow-y: auto; margin-bottom:20px;"></div>
            <div style="text-align:right; font-size:1.5rem; font-weight:bold; margin-bottom:20px; border-top:2px solid var(--bg); padding-top:10px; color:var(--text);" id="checkout-total">Total: $0</div>
            <div style="display:flex; gap:10px;">
                <button class="btn btn-danger" style="margin:0;" onclick="document.getElementById('checkout-modal').style.display='none'">Cerrar</button>
                <button class="btn btn-success" style="margin:0;" onclick="finishSale()">Cobrar</button>
            </div>
        </div>
    </div>

    <div id="settings-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:3000; align-items:center; justify-content:center;">
        <div style="background:white; width:90%; max-width:400px; padding:25px; border-radius:15px; text-align:center; position:relative; border-top: 5px solid var(--primary);">
            <button onclick="closeSettings()" style="position:absolute; top:10px; right:15px; background:none; border:none; font-size:1.5rem; color:var(--danger); cursor:pointer;">âœ•</button>
            <h2 style="margin-top:0;">Ajustes âš™ï¸</h2>
            <button id="btn-set-flav" class="btn btn-primary hidden-role" onclick="showAddFlavor()">Agregar Sabores ğŸ“</button>
            <button id="btn-set-pal" class="btn btn-primary hidden-role" style="background:var(--ferguz-blue); color:white;" onclick="showAddPaleta()">Agregar Paletas ğŸ­</button>
            <button id="btn-set-edit" class="btn btn-success hidden-role" style="background:var(--ferguz-yellow); color:var(--text);" onclick="showEditFlavors()">Editar Inventario âœï¸</button>
            <button class="btn btn-danger" style="margin-top:25px;" onclick="doLogout(); closeSettings();">Cerrar SesiÃ³n ğŸšª</button>
        </div>
    </div>

    <div id="add-flavor-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:3100; align-items:center; justify-content:center;">
        <div style="background:white; width:90%; max-width:400px; padding:25px; border-radius:15px; border-top: 5px solid var(--primary);">
            <h3 style="color:var(--primary); margin-top:0;">Nuevo Sabor (Agua)</h3>
            <input type="text" id="new-flavor-name" class="login-input" placeholder="Nombre del sabor">
            <select id="new-flavor-type" class="login-input"><option value="fruta">Fruta ğŸ“</option><option value="crema">Crema ğŸ¥›</option></select>
            <input type="number" id="new-flavor-stock" class="login-input" placeholder="Stock inicial (Litros)" min="0">
            <div style="display:flex; gap:10px; margin-top:15px;">
                <button class="btn btn-danger" style="margin:0;" onclick="document.getElementById('add-flavor-modal').style.display='none'">Cancelar</button>
                <button class="btn btn-success" style="margin:0; background:var(--ferguz-green); color:#004d25;" onclick="saveNewFlavor()">Guardar</button>
            </div>
        </div>
    </div>

    <div id="add-paleta-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:3100; align-items:center; justify-content:center;">
        <div style="background:white; width:90%; max-width:400px; padding:25px; border-radius:15px; border-top: 5px solid var(--ferguz-blue);">
            <h3 style="color:var(--ferguz-blue); margin-top:0;">Nueva Paleta</h3>
            <input type="text" id="new-paleta-name" class="login-input" placeholder="Nombre de la paleta" style="border-color:var(--ferguz-blue);">
            <input type="number" id="new-paleta-price" class="login-input" placeholder="Precio Fijo ($)" min="0" style="border-color:var(--ferguz-blue);">
            <input type="number" id="new-paleta-stock" class="login-input" placeholder="Stock inicial (Piezas)" min="0" style="border-color:var(--ferguz-blue);">
            <div style="display:flex; gap:10px; margin-top:15px;">
                <button class="btn btn-danger" style="margin:0;" onclick="document.getElementById('add-paleta-modal').style.display='none'">Cancelar</button>
                <button class="btn btn-success" style="margin:0; background:var(--ferguz-green); color:#004d25;" onclick="saveNewPaleta()">Guardar</button>
            </div>
        </div>
    </div>

    <div id="edit-flavors-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:3100; align-items:center; justify-content:center;">
        <div style="background:white; width:95%; max-width:500px; padding:20px; border-radius:15px; max-height:90vh; display:flex; flex-direction:column; border-top: 5px solid var(--ferguz-yellow);">
            <h3 style="color:var(--text); margin-top:0;">Editar Inventario âœï¸</h3>
            <p style="font-size:0.8rem; color:#666; margin-top:0;">Modifica los campos y presiona ğŸ’¾ para guardar, o ğŸ—‘ï¸ para borrar.</p>
            <div id="edit-list-container" style="overflow-y:auto; flex:1; margin-bottom:15px; padding-right:5px;"></div>
            <button class="btn btn-danger" onclick="document.getElementById('edit-flavors-modal').style.display='none'">Cerrar Panel</button>
        </div>
    </div>

    <div id="cut-detail-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:4000; align-items:center; justify-content:center;">
        <div style="background:white; width:95%; max-width:500px; padding:20px; border-radius:15px; max-height:90vh; display:flex; flex-direction:column; border-top: 5px solid var(--primary);">
            <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:2px solid var(--primary); padding-bottom:10px; margin-bottom:10px;">
                <h3 id="cut-detail-title" style="color:var(--primary); margin:0;">Detalle de Corte</h3>
                <button onclick="document.getElementById('cut-detail-modal').style.display='none'" style="background:none; border:none; font-size:1.5rem; color:var(--danger); cursor:pointer;">âœ•</button>
            </div>
            <div id="cut-detail-stats" style="background:var(--bg); padding:10px; border-radius:10px; margin-bottom:15px; font-size:0.9rem;"></div>
            <strong style="color:var(--primary); margin-bottom:5px;">Movimientos del Turno:</strong>
            <div id="cut-detail-list" style="overflow-y:auto; flex:1; margin-bottom:15px; font-size:0.85rem; border:2px solid var(--bg); border-radius:8px; padding:10px;"></div>
            <button class="btn btn-primary" onclick="document.getElementById('cut-detail-modal').style.display='none'">Cerrar Detalles</button>
        </div>
    </div>

    <nav>
        <button id="nav-pos" class="nav-btn active" onclick="go('pos', this)"><span class="nav-icon">ğŸª</span>Venta</button>
        <button id="nav-prod" class="nav-btn" onclick="go('prod', this)"><span class="nav-icon">ğŸ­</span>Prod.</button>
        <button id="nav-admin" class="nav-btn" onclick="go('admin', this)"><span class="nav-icon">ğŸ“Š</span>Admin</button>
        <button id="nav-historial" class="nav-btn" onclick="go('historial', this)"><span class="nav-icon">ğŸ§¾</span>Historial</button>
    </nav>

    <script src="app.js"></script>

</body>
</html>

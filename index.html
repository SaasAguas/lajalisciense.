<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>La Jalisciense Pro v3.1</title>
    <style>
        :root {
            --primary: #6A1B9A; --accent: #00E676; --bg: #F3E5F5;
            --card: #FFFFFF; --text: #2D3436; --shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        body { 
            font-family: system-ui, -apple-system, sans-serif; 
            margin: 0; background: var(--bg); color: var(--text); padding-bottom: 80px;
        }

        /* --- NAVEGACI√ìN Y PANTALLAS --- */
        .screen { display: none; padding: 15px; animation: fadeIn 0.3s; }
        .active-screen { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* --- LOGIN --- */
        #login-overlay {
            position: fixed; inset: 0; background: var(--primary);
            display: flex; align-items: center; justify-content: center; z-index: 9999;
        }
        .login-box { background: white; padding: 25px; border-radius: 20px; width: 80%; max-width: 320px; text-align: center; }

        /* --- CARDS --- */
        .card { background: white; padding: 15px; border-radius: 15px; box-shadow: var(--shadow); margin-bottom: 15px; }
        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .item-card { 
            background: white; border: 1px solid #eee; padding: 12px; border-radius: 12px; 
            text-align: center; cursor: pointer; transition: 0.2s;
        }
        .item-card:active { background: #E1BEE7; transform: scale(0.95); }

        /* --- HEADER & NAV --- */
        nav { 
            position: fixed; bottom: 0; width: 100%; background: white; 
            display: flex; justify-content: space-around; padding: 12px 0; border-top: 1px solid #ddd;
        }
        .nav-btn { background: none; border: none; color: #999; font-weight: bold; font-size: 0.8rem; }
        .nav-btn.active { color: var(--primary); }
        .hidden { display: none !important; }

        /* --- BOTONES --- */
        .btn { width: 100%; padding: 12px; border: none; border-radius: 10px; font-weight: bold; margin-top: 10px; cursor: pointer; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-success { background: var(--accent); color: #004d25; }

        .cart-bar {
            position: fixed; bottom: 75px; left: 15px; right: 15px;
            background: var(--primary); color: white; padding: 15px;
            border-radius: 50px; display: none; justify-content: space-between; align-items: center;
        }
    </style>
</head>
<body>

    <div id="login-overlay">
        <div class="login-box">
            <h2>üç¶ Bienvenida</h2>
            <input type="text" id="user-in" placeholder="Usuario" style="width:90%; padding:10px; margin:5px;"><br>
            <input type="password" id="pass-in" placeholder="Contrase√±a" style="width:90%; padding:10px; margin:5px;"><br>
            <button class="btn btn-primary" onclick="handleLogin()">Entrar</button>
        </div>
    </div>

    <div id="app-content">
        <div id="scr-pos" class="screen active-screen">
            <div class="card">
                <div style="display:flex; gap:5px; margin-bottom:15px;">
                    <button class="btn btn-primary" onclick="setFilter('fruta')">Fruta</button>
                    <button class="btn btn-primary" onclick="setFilter('crema')">Crema</button>
                    <button class="btn btn-primary" onclick="setFilter('paleta')">Paletas</button>
                </div>
                <div class="grid" id="pos-grid"></div>
            </div>
        </div>

        <div id="scr-admin" class="screen">
            <div class="card" style="background:var(--primary); color:white; text-align:center;">
                <h3>Caja Actual</h3>
                <h1 id="cash-display">$0</h1>
            </div>
            <div class="card">
                <h3>Inventario Actual</h3>
                <div id="inv-list"></div>
            </div>
            <button class="btn btn-primary" onclick="exportData()">Descargar Reporte</button>
        </div>
    </div>

    <div id="cart-bar" class="cart-bar" onclick="finishSale()">
        <span>üõí <span id="cart-count">0</span> productos</span>
        <span id="cart-total">$0</span>
        <span>COBRAR</span>
    </div>

    <nav id="main-nav">
        <button id="n-pos" class="nav-btn active" onclick="go('pos')">VENTA</button>
        <button id="n-admin" class="nav-btn" onclick="go('admin')">ADMIN</button>
    </nav>

    <script>
        // 1. Datos iniciales
        const DB_KEY = 'jalisciense_db_v3';
        const initialFlavors = [
            {n:'Jamaica', t:'fruta', s:20, p:20}, {n:'Maracuya', t:'fruta', s:20, p:20},
            {n:'Horchata', t:'crema', s:20, p:15}, {n:'Mazapan', t:'crema', s:20, p:15},
            {n:'Paleta Agua', t:'paleta', s:50, p:25}
        ];

        let db = JSON.parse(localStorage.getItem(DB_KEY)) || {
            cash: 0, inventory: initialFlavors, sales: []
        };

        let cart = [];
        let currentFilter = 'fruta';

        // 2. Funciones de Navegaci√≥n y Login
        function handleLogin() {
            const u = document.getElementById('user-in').value;
            if(u === 'admin') {
                document.getElementById('login-overlay').style.display = 'none';
                updateUI();
            }
        }

        function go(scr) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active-screen'));
            document.getElementById('scr-' + scr).classList.add('active-screen');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('n-' + scr).classList.add('active');
        }

        // 3. L√≥gica de Negocio
        function setFilter(f) {
            currentFilter = f;
            updateUI();
        }

        function addToCart(index) {
            const item = db.inventory[index];
            if(item.s > 0) {
                cart.push({...item, originalIndex: index});
                updateUI();
            } else {
                alert("Sin inventario");
            }
        }

        function finishSale() {
            let total = 0;
            cart.forEach(item => {
                total += item.p;
                db.inventory[item.originalIndex].s -= 1; // Resta 1 unidad/litro
            });
            db.cash += total;
            db.sales.push({ date: new Date(), total: total, items: cart.length });
            
            cart = [];
            save();
            alert("Venta completada");
            updateUI();
        }

        function save() {
            localStorage.setItem(DB_KEY, JSON.stringify(db));
        }

        function updateUI() {
            // Render Venta
            const grid = document.getElementById('pos-grid');
            grid.innerHTML = '';
            db.inventory.forEach((item, index) => {
                if(item.t === currentFilter) {
                    grid.innerHTML += `
                        <div class="item-card" onclick="addToCart(${index})">
                            <strong>${item.n}</strong><br>
                            <small>${item.s} disp.</small><br>
                            <b>$${item.p}</b>
                        </div>`;
                }
            });

            // Barra de carrito
            const bar = document.getElementById('cart-bar');
            if(cart.length > 0) {
                bar.style.display = 'flex';
                document.getElementById('cart-count').innerText = cart.length;
                document.getElementById('cart-total').innerText = '$' + cart.reduce((a,b)=>a+b.p, 0);
            } else {
                bar.style.display = 'none';
            }

            // Admin
            document.getElementById('cash-display').innerText = '$' + db.cash;
            const invList = document.getElementById('inv-list');
            invList.innerHTML = db.inventory.map(i => `<div>${i.n}: ${i.s}</div>`).join('');
        }

        function exportData() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(db));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "reporte_jalisciense.json");
            downloadAnchorNode.click();
        }
    </script>
</body>
</html>
